{% extends 'blog/boshlash.html' %}
{% load static %}

{% block title %}Kitob yuklash - Cloudstore{% endblock %}

{% block content %}
<style>
    :root {
        --amz-orange: #ff9900;
        --amz-orange-hover: #ffad33;
        --amz-dark: #131921;
        --amz-light-dark: #232f3e;
        --amz-text: #0f1111;
        --amz-link: #007185;
        --amz-link-hover: #c7511f;
        --amz-border: #ddd;
        --amz-bg: #eaeded;
        --amz-card: #fff;
        --amz-green: #067d62;
        --amz-success: #067d62;
        --amz-error: #c40000;
    }

    body.dark-mode {
        --amz-text: #e0e0e0;
        --amz-bg: #0f1111;
        --amz-card: #1a1a1a;
        --amz-border: #333;
        --amz-link: #4fc3f7;
    }

    .amz-upload-wrapper {
        background: var(--amz-bg);
        min-height: 100vh;
    }

    /* Hero Banner */
    .amz-hero-banner {
        background: linear-gradient(135deg, rgba(19, 25, 33, 0.75) 0%, rgba(35, 47, 62, 0.85) 100%),
                    url('https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=1200&q=80');
        background-size: cover;
        background-position: center;
        padding: 50px 20px;
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    body.dark-mode .amz-hero-banner {
        background: linear-gradient(135deg, rgba(0, 0, 0, 0.8) 0%, rgba(19, 25, 33, 0.9) 100%),
                    url('https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=1200&q=80');
        background-size: cover;
        background-position: center;
    }

    .amz-hero-banner::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ff9900' fill-opacity='0.08'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        opacity: 0.5;
    }

    .amz-hero-content {
        position: relative;
        z-index: 1;
        max-width: 600px;
        margin: 0 auto;
    }

    .amz-hero-logo {
        width: 80px;
        height: 80px;
        background: var(--amz-orange);
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        font-size: 2.5rem;
        box-shadow: 0 8px 30px rgba(255, 153, 0, 0.3);
        color: #fff;
    }

    .amz-hero-title {
        color: #fff;
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 10px;
    }

    .amz-hero-title span {
        color: var(--amz-orange);
    }

    .amz-hero-subtitle {
        color: rgba(255,255,255,0.85);
        font-size: 1.05rem;
        line-height: 1.5;
    }

    /* Main Container */
    .amz-upload-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 25px 20px 40px;
    }

    /* Quick Nav */
    .amz-quick-nav {
        display: flex;
        gap: 12px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }

    .amz-nav-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 18px;
        background: var(--amz-card);
        border: 1px solid var(--amz-border);
        border-radius: 8px;
        color: var(--amz-link);
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.2s;
    }

    .amz-nav-btn:hover {
        border-color: var(--amz-orange);
        color: var(--amz-orange);
        background: #fef8e8;
    }

    body.dark-mode .amz-nav-btn:hover {
        background: #2a2510;
    }

    /* Success Card */
    .amz-success-card {
        background: linear-gradient(135deg, var(--amz-green), #055c49);
        border-radius: 8px;
        padding: 30px;
        text-align: center;
        margin-bottom: 20px;
        color: #fff;
    }

    .amz-success-card i {
        font-size: 3rem;
        margin-bottom: 15px;
        opacity: 0.9;
    }

    .amz-success-card h2 {
        font-size: 1.4rem;
        margin-bottom: 8px;
    }

    .amz-success-card p {
        opacity: 0.9;
        margin-bottom: 20px;
    }

    .amz-success-actions {
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .amz-success-actions a {
        padding: 10px 20px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        font-size: 0.9rem;
        transition: all 0.2s;
    }

    .amz-success-actions .primary-btn {
        background: linear-gradient(to bottom, #f7dfa5, #f0c14b);
        border: 1px solid #a88734;
        color: #111;
    }

    .amz-success-actions .primary-btn:hover {
        background: linear-gradient(to bottom, #f5d78e, #eeb933);
    }

    .amz-success-actions .secondary-btn {
        background: rgba(255,255,255,0.15);
        border: 1px solid rgba(255,255,255,0.3);
        color: #fff;
    }

    .amz-success-actions .secondary-btn:hover {
        background: rgba(255,255,255,0.25);
    }

    /* Section Card */
    .amz-section-card {
        background: var(--amz-card);
        border: 1px solid var(--amz-border);
        border-radius: 8px;
        margin-bottom: 20px;
        overflow: hidden;
    }

    .amz-section-header {
        background: var(--amz-light-dark);
        padding: 12px 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .amz-section-header i {
        color: var(--amz-orange);
        font-size: 1rem;
    }

    .amz-section-header h2 {
        color: #fff;
        font-size: 0.95rem;
        font-weight: 600;
        margin: 0;
    }

    .amz-section-body {
        padding: 25px;
    }

    /* Messages */
    .amz-alert {
        padding: 12px 18px;
        border-radius: 8px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 0.95rem;
    }

    .amz-alert-success {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
    }

    .amz-alert-error {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
    }

    body.dark-mode .amz-alert-success {
        background: #0d2117;
        border-color: #0d4b22;
        color: #4caf50;
    }

    body.dark-mode .amz-alert-error {
        background: #2a0f0f;
        border-color: #4a1515;
        color: #ff6b6b;
    }

    /* Form Styles */
    .amz-form-group {
        margin-bottom: 20px;
    }

    .amz-form-label {
        display: block;
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--amz-text);
        margin-bottom: 6px;
    }

    .amz-form-label .required {
        color: var(--amz-error);
    }

    .amz-form-input,
    .amz-form-textarea,
    .amz-form-select {
        width: 100%;
        padding: 12px 14px;
        border: 1px solid var(--amz-border);
        border-radius: 8px;
        font-size: 0.95rem;
        color: var(--amz-text);
        background: var(--amz-card);
        transition: all 0.2s;
        font-family: inherit;
    }

    .amz-form-input:focus,
    .amz-form-textarea:focus,
    .amz-form-select:focus {
        outline: none;
        border-color: var(--amz-orange);
        box-shadow: 0 0 0 3px rgba(255, 153, 0, 0.15);
    }

    .amz-form-textarea {
        min-height: 100px;
        resize: vertical;
    }

    /* Author Section */
    .amz-author-box {
        background: #f7f8fa;
        border: 1px solid var(--amz-border);
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
    }

    body.dark-mode .amz-author-box {
        background: #1a1a1a;
    }

    .amz-author-title {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 1rem;
        font-weight: 600;
        color: var(--amz-text);
        margin-bottom: 15px;
    }

    .amz-author-title i {
        color: var(--amz-orange);
    }

    .amz-toggle-btns {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
    }

    .amz-toggle-btn {
        flex: 1;
        padding: 12px 15px;
        border: 2px solid var(--amz-border);
        border-radius: 8px;
        background: var(--amz-card);
        color: var(--amz-text);
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    .amz-toggle-btn:hover {
        border-color: var(--amz-orange);
    }

    .amz-toggle-btn.active {
        border-color: var(--amz-orange);
        background: linear-gradient(to bottom, #fef8e8, #fdf3d9);
        color: #854d0e;
    }

    body.dark-mode .amz-toggle-btn.active {
        background: linear-gradient(to bottom, #2a2510, #231f0c);
        color: var(--amz-orange);
    }

    .amz-author-input {
        display: none;
    }

    .amz-author-input.active {
        display: block;
    }

    /* File Upload */
    .amz-file-upload {
        position: relative;
        border: 2px dashed var(--amz-border);
        border-radius: 8px;
        padding: 35px 20px;
        text-align: center;
        transition: all 0.2s;
        background: #fafafa;
        cursor: pointer;
    }

    body.dark-mode .amz-file-upload {
        background: #1a1a1a;
    }

    .amz-file-upload:hover {
        border-color: var(--amz-orange);
        background: #fef8e8;
    }

    body.dark-mode .amz-file-upload:hover {
        background: #2a2510;
    }

    .amz-file-upload.dragover {
        border-color: var(--amz-orange);
        background: #fef8e8;
        transform: scale(1.01);
    }

    .amz-file-upload input {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        opacity: 0;
        cursor: pointer;
    }

    .amz-file-icon {
        font-size: 2.5rem;
        color: var(--amz-orange);
        margin-bottom: 12px;
    }

    .amz-file-text {
        color: var(--amz-text);
        font-size: 0.95rem;
    }

    .amz-file-text strong {
        color: var(--amz-link);
    }

    .amz-file-info {
        display: none;
        margin-top: 15px;
        padding: 12px 15px;
        background: #d4edda;
        border: 1px solid #c3e6cb;
        border-radius: 8px;
        color: #155724;
        font-size: 0.9rem;
    }

    body.dark-mode .amz-file-info {
        background: #0d2117;
        border-color: #0d4b22;
        color: #4caf50;
    }

    .amz-file-info.show {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .amz-format-hint {
        margin-top: 12px;
        padding: 12px 15px;
        background: #fff3cd;
        border: 1px solid #ffc107;
        border-radius: 8px;
        font-size: 0.85rem;
        color: #856404;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    body.dark-mode .amz-format-hint {
        background: #2a2510;
        border-color: #6b5900;
        color: #ffc107;
    }

    /* Submit Button */
    .amz-submit-btn {
        width: 100%;
        padding: 14px 28px;
        background: linear-gradient(to bottom, #f7dfa5, #f0c14b);
        border: 1px solid #a88734;
        border-radius: 8px;
        color: #111;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

    .amz-submit-btn:hover {
        background: linear-gradient(to bottom, #f5d78e, #eeb933);
    }

    .amz-submit-btn:active {
        background: linear-gradient(to bottom, #e8c445, #ddaa20);
    }

    .amz-submit-btn:disabled {
        background: #e0e0e0;
        border-color: #ccc;
        color: #888;
        cursor: not-allowed;
    }

    /* Back Link */
    .amz-back-section {
        text-align: center;
        padding: 25px 0;
    }

    .amz-back-link {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: var(--amz-link);
        text-decoration: none;
        font-size: 0.95rem;
        padding: 10px 25px;
        border: 1px solid var(--amz-link);
        border-radius: 20px;
        transition: all 0.2s;
    }

    .amz-back-link:hover {
        background: var(--amz-link);
        color: #fff;
    }

    /* Tips Card */
    .amz-tips-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .amz-tips-list li {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        padding: 10px 0;
        border-bottom: 1px solid var(--amz-border);
        color: var(--amz-text);
        font-size: 0.95rem;
    }

    .amz-tips-list li:last-child {
        border-bottom: none;
    }

    .amz-tips-list li i {
        color: var(--amz-green);
        margin-top: 3px;
    }

    /* Responsive */
    @media (max-width: 600px) {
        .amz-hero-title {
            font-size: 1.6rem;
        }
        .amz-toggle-btns {
            flex-direction: column;
        }
        .amz-quick-nav {
            flex-direction: column;
        }
        .amz-success-actions {
            flex-direction: column;
        }
    }
</style>

<div class="amz-upload-wrapper">
    <!-- Hero Banner -->
    <div class="amz-hero-banner">
        <div class="amz-hero-content">
            <div class="amz-hero-logo">
                <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <h1 class="amz-hero-title">Kitob <span>yuklash</span></h1>
            <p class="amz-hero-subtitle">
                Yangi kitob qo'shing va Cloudstore kutubxonasini boyiting
            </p>
        </div>
    </div>

    <div class="amz-upload-container">
        <!-- Quick Navigation -->
        <div class="amz-quick-nav">
            <a href="{% url 'boshlash' %}" class="amz-nav-btn">
                <i class="fas fa-arrow-left"></i> Orqaga
            </a>
            <a href="{% url 'all_books' %}" class="amz-nav-btn">
                <i class="fas fa-book-open"></i> Barcha kitoblar
            </a>
        </div>

        {% if success %}
        <!-- Success Card -->
        <div class="amz-success-card">
            <i class="fas fa-check-circle"></i>
            <h2>Muvaffaqiyatli yuklandi!</h2>
            <p>"{{ book.title }}" kitobi kutubxonaga qo'shildi</p>
            <div class="amz-success-actions">
                <a href="{% url 'book_list' book.author.id %}" class="primary-btn">
                    <i class="fas fa-eye"></i> Kitobni ko'rish
                </a>
                <a href="{% url 'kitob_yuklash' %}" class="secondary-btn">
                    <i class="fas fa-plus"></i> Yana yuklash
                </a>
            </div>
        </div>
        {% endif %}

        <!-- Messages -->
        {% if messages %}
        {% for message in messages %}
        <div class="amz-alert amz-alert-{{ message.tags }}">
            {% if message.tags == 'success' %}
            <i class="fas fa-check-circle"></i>
            {% else %}
            <i class="fas fa-exclamation-circle"></i>
            {% endif %}
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}

        <!-- Upload Tips -->
        <div class="amz-section-card">
            <div class="amz-section-header">
                <i class="fas fa-lightbulb"></i>
                <h2>Yuklash bo'yicha maslahatlar</h2>
            </div>
            <div class="amz-section-body">
                <ul class="amz-tips-list">
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>Qabul qilinadigan formatlar: DOCX, DOC, TXT</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>Kitob nomi aniq va to'g'ri yozilganiga ishonch hosil qiling</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>Mavjud muallifni tanlashingiz yoki yangi muallif qo'shishingiz mumkin</span>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Upload Form -->
        <div class="amz-section-card">
            <div class="amz-section-header">
                <i class="fas fa-upload"></i>
                <h2>Kitob ma'lumotlari</h2>
            </div>
            <div class="amz-section-body">
                <form method="POST" enctype="multipart/form-data" id="uploadForm">
                    {% csrf_token %}
                    
                    <div class="amz-form-group">
                        <label class="amz-form-label">
                            <i class="fas fa-book"></i> Kitob nomi <span class="required">*</span>
                        </label>
                        <input type="text" name="title" class="amz-form-input" 
                               placeholder="Kitob nomini kiriting..." required>
                    </div>

                    <!-- Author Section -->
                    <div class="amz-author-box">
                        <div class="amz-author-title">
                            <i class="fas fa-user-pen"></i> Muallif
                        </div>
                        
                        <div class="amz-toggle-btns">
                            <div class="amz-toggle-btn active" data-target="existing">
                                <i class="fas fa-list"></i> Mavjud muallifdan
                            </div>
                            <div class="amz-toggle-btn" data-target="new">
                                <i class="fas fa-user-plus"></i> Yangi muallif
                            </div>
                        </div>

                        <div class="amz-author-input active" id="existing">
                            <select name="author_id" class="amz-form-select" title="Muallif tanlang">
                                <option value="">-- Muallif tanlang --</option>
                                {% for author in authors %}
                                <option value="{{ author.id }}">{{ author.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="amz-author-input" id="new">
                            <input type="text" name="new_author_name" class="amz-form-input"
                                   placeholder="Yangi muallif ismini kiriting...">
                        </div>
                    </div>

                    <div class="amz-form-group">
                        <label class="amz-form-label">
                            <i class="fas fa-align-left"></i> Qisqacha tavsif
                        </label>
                        <textarea name="description" class="amz-form-textarea" 
                                  placeholder="Kitob haqida qisqacha ma'lumot..."></textarea>
                    </div>

                    <div class="amz-form-group">
                        <label class="amz-form-label">
                            <i class="fas fa-calendar"></i> Nashr yili
                        </label>
                        <input type="number" name="published_year" class="amz-form-input"
                               placeholder="Masalan: 2024" min="1000" max="2100">
                    </div>

                    <div class="amz-form-group">
                        <label class="amz-form-label">
                            <i class="fas fa-file-upload"></i> Kitob fayli <span class="required">*</span>
                        </label>
                        <div class="amz-file-upload" id="fileUpload">
                            <input type="file" name="book_file" id="bookFile" 
                                   accept=".pdf,.doc,.docx,.txt" required title="Kitob faylini tanlang">
                            <div class="amz-file-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div class="amz-file-text">
                                <strong>Faylni tanlash</strong> yoki bu yerga tashlang
                            </div>
                        </div>
                        <div class="amz-file-info" id="fileInfo">
                            <i class="fas fa-file-check"></i>
                            <span id="fileName"></span>
                        </div>
                        <div class="amz-format-hint">
                            <i class="fas fa-info-circle"></i>
                            Qabul qilinadigan formatlar: DOCX, DOC, TXT
                        </div>
                    </div>

                    <button type="submit" class="amz-submit-btn" id="submitBtn">
                        <i class="fas fa-upload"></i> Kitobni yuklash
                    </button>
                </form>
            </div>
        </div>

        <!-- Back Link -->
        <div class="amz-back-section">
            <a href="{% url 'boshlash' %}" class="amz-back-link">
                <i class="fas fa-arrow-left"></i> Bosh sahifaga qaytish
            </a>
        </div>
    </div>
</div>

<script>
    // Author toggle
    document.querySelectorAll('.amz-toggle-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.amz-toggle-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.amz-author-input').forEach(i => i.classList.remove('active'));
            
            this.classList.add('active');
            document.getElementById(this.dataset.target).classList.add('active');
            
            if (this.dataset.target === 'existing') {
                document.querySelector('input[name="new_author_name"]').value = '';
            } else {
                document.querySelector('select[name="author_id"]').value = '';
            }
        });
    });

    // File upload
    const fileInput = document.getElementById('bookFile');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');

    fileInput.addEventListener('change', function() {
        if (this.files.length > 0) {
            fileName.textContent = this.files[0].name;
            fileInfo.classList.add('show');
        } else {
            fileInfo.classList.remove('show');
        }
    });

    // Drag and drop
    const upload = document.getElementById('fileUpload');
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        upload.addEventListener(eventName, e => {
            e.preventDefault();
            e.stopPropagation();
        });
    });
    ['dragenter', 'dragover'].forEach(eventName => {
        upload.addEventListener(eventName, () => upload.classList.add('dragover'));
    });
    ['dragleave', 'drop'].forEach(eventName => {
        upload.addEventListener(eventName, () => upload.classList.remove('dragover'));
    });
    upload.addEventListener('drop', function(e) {
        const files = e.dataTransfer.files;
        const input = this.querySelector('input');
        input.files = files;
        input.dispatchEvent(new Event('change'));
    });

    // Form submit loading
    document.getElementById('uploadForm').addEventListener('submit', function() {
        const btn = document.getElementById('submitBtn');
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Yuklanmoqda...';
    });
</script>
{% endblock %}
